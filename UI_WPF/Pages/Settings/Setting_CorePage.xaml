<Page
    x:Class="Another_Mirai_Native.UI.Pages.Setting_CorePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:Another_Mirai_Native.UI.Controls"
    xmlns:converters="clr-namespace:Another_Mirai_Native.UI.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:emoji="clr-namespace:Emoji.Wpf;assembly=Emoji.Wpf"
    xmlns:local="clr-namespace:Another_Mirai_Native.UI.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.modernwpf.com/2019"
    Title="Setting_CorePage"
    d:DataContext="{d:DesignInstance Type=local:Setting_CorePage}"
    d:DesignWidth="800"
    Loaded="Page_Loaded"
    mc:Ignorable="d">

    <Page.Resources>
        <converters:EnumToItemsSourceConverter x:Key="EnumToItemsSourceConverter" />
        <converters:EnumDescriptionConverter x:Key="EnumDescriptionConverter" />
    </Page.Resources>
    <ui:SimpleStackPanel Margin="10,10,20,0" Spacing="10">
        <!--  连接设置  -->
        <Border
            Margin="0,0,0,15"
            Padding="10"
            Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
            BorderBrush="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
            BorderThickness="1"
            CornerRadius="8">
            <ui:SimpleStackPanel Spacing="10">
                <emoji:TextBlock
                    Margin="0,0,0,5"
                    FontSize="16"
                    FontWeight="SemiBold"
                    Style="{StaticResource TitleTextBlockStyle}">
                    🚀 连接设置
                </emoji:TextBlock>

                <controls:SettingItem_ToggleButton
                    x:Name="AutoConnect"
                    Title="协议自动连接"
                    OnToggled="SettingItem_Toggled"
                    Subtitle="启动时自动连接协议" />

                <controls:SettingItem_ComboBox
                    x:Name="AutoProtocol"
                    Title="自动连接协议"
                    ItemSources="{Binding Protocols}"
                    SelectedItemChanged="SettingItem_ComboBox_SelectedItemChanged"
                    Subtitle="选择启动时自动连接的协议" />

                <controls:SettingItem_TextBox
                    x:Name="ReconnectTime"
                    Title="重新连接间隔时间"
                    DataChanged="SettingItem_TextBox_DataChanged"
                    Subtitle="协议失去连接时每次重新连接的间隔时间"
                    Unit="ms" />
            </ui:SimpleStackPanel>
        </Border>

        <!--  插件管理  -->
        <Border
            Margin="0,0,0,15"
            Padding="10"
            Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
            BorderBrush="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
            BorderThickness="1"
            CornerRadius="8">
            <ui:SimpleStackPanel Spacing="10">
                <emoji:TextBlock
                    Margin="0,0,0,5"
                    FontSize="16"
                    FontWeight="SemiBold"
                    Style="{StaticResource TitleTextBlockStyle}">
                    🔌 插件管理
                </emoji:TextBlock>
                <controls:SettingItem_ToggleButton
                    x:Name="PluginExitWhenCoreExit"
                    Title="框架退出时插件自动退出"
                    OnToggled="SettingItem_Toggled"
                    Subtitle="主程序退出时自动关闭所有插件" />

                <controls:SettingItem_ToggleButton
                    x:Name="RestartPluginIfDead"
                    Title="插件崩溃时自动重启"
                    OnToggled="SettingItem_Toggled"
                    Subtitle="插件发生异常时自动重新启动" />

                <controls:SettingItem_TextBox
                    x:Name="HeartBeatInterval"
                    Title="心跳间隔时间"
                    DataChanged="SettingItem_TextBox_DataChanged"
                    Subtitle="核心与插件之间的心跳检测间隔"
                    Unit="ms" />

                <controls:SettingItem_TextBox
                    x:Name="PluginInvokeTimeout"
                    Title="插件方法调用超时"
                    DataChanged="SettingItem_TextBox_DataChanged"
                    Unit="ms" />

                <controls:SettingItem_TextBox
                    x:Name="LoadTimeout"
                    Title="插件载入超时"
                    DataChanged="SettingItem_TextBox_DataChanged"
                    Unit="ms" />
            </ui:SimpleStackPanel>
        </Border>

        <!--  数据管理  -->
        <Border
            Margin="0,0,0,15"
            Padding="10"
            Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
            BorderBrush="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
            BorderThickness="1"
            CornerRadius="8">
            <ui:SimpleStackPanel Spacing="10">
                <emoji:TextBlock
                    Margin="0,0,0,5"
                    FontSize="16"
                    FontWeight="SemiBold"
                    Style="{StaticResource TitleTextBlockStyle}">
                    💾 数据管理
                </emoji:TextBlock>
                <controls:SettingItem_ToggleButton
                    x:Name="UseDatabase"
                    Title="日志使用数据库"
                    OnToggled="SettingItem_Toggled"
                    Subtitle="是否将日志存储到数据库" />

                <controls:SettingItem_TextBox
                    x:Name="MessageCacheSize"
                    Title="消息缓存数量"
                    DataChanged="SettingItem_TextBox_DataChanged"
                    Subtitle="内存中缓存的消息数量限制"
                    Unit="条" />
            </ui:SimpleStackPanel>
        </Border>

        <!--  聊天功能  -->
        <Border
            Margin="0,0,0,15"
            Padding="10"
            Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
            BorderBrush="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
            BorderThickness="1"
            CornerRadius="8">
            <ui:SimpleStackPanel Spacing="10">
                <emoji:TextBlock
                    Margin="0,0,0,5"
                    FontSize="16"
                    FontWeight="SemiBold"
                    Style="{StaticResource TitleTextBlockStyle}">
                    💬 图片缓存
                </emoji:TextBlock>
                <controls:SettingItem_ToggleButton
                    x:Name="EnableChatImageCacheMaxSizeControl"
                    Title="启用最大缓存图片体积控制"
                    OnToggled="SettingItem_Toggled"
                    Subtitle="缓存文件夹超出体积时，会从最久的图片开始删除" />

                <controls:SettingItem_TextBox
                    x:Name="MaxChatImageCacheFolderSize"
                    Title="缓存文件夹最大大小"
                    DataChanged="SettingItem_TextBox_DataChanged"
                    Unit="MB" />

                <controls:SettingItem_ToggleButton
                    x:Name="EnableChatImageCacheExpireTimeControl"
                    Title="启用缓存图片最大储存时限控制"
                    OnToggled="SettingItem_Toggled"
                    Subtitle="图片最大保留一点天数后，会从最久的图片开始删除" />

                <controls:SettingItem_TextBox
                    x:Name="ChatImageCacheExpireTime"
                    Title="缓存图片最大储存时限"
                    DataChanged="SettingItem_TextBox_DataChanged"
                    Unit="天" />
            </ui:SimpleStackPanel>
        </Border>

        <!--  调试设置  -->
        <Border
            Margin="0,0,0,15"
            Padding="10"
            Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
            BorderBrush="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
            BorderThickness="1"
            CornerRadius="8">
            <ui:SimpleStackPanel Spacing="10">
                <TextBlock
                    Margin="0,0,0,5"
                    FontSize="16"
                    FontWeight="SemiBold"
                    Style="{StaticResource TitleTextBlockStyle}">
                    🔧 调试设置
                </TextBlock>
                <controls:SettingItem_ToggleButton
                    x:Name="DebugMode"
                    Title="调试模式"
                    OnToggled="SettingItem_Toggled"
                    Subtitle="启用调试模式输出详细信息" />
            </ui:SimpleStackPanel>
        </Border>

        <!--  离线操作  -->
        <Border
            Margin="0,0,0,15"
            Padding="10"
            Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
            BorderBrush="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
            BorderThickness="1"
            CornerRadius="8">
            <ui:SimpleStackPanel Spacing="10">
                <emoji:TextBlock
                    Margin="0,0,0,5"
                    FontSize="16"
                    FontWeight="SemiBold"
                    Style="{StaticResource TitleTextBlockStyle}">
                    📴 离线操作
                </emoji:TextBlock>
                <controls:SettingItem_TextBox
                    x:Name="ActionAfterOfflineSeconds"
                    Title="离线操作等待时间"
                    DataChanged="SettingItem_TextBox_DataChanged"
                    Subtitle="离线后执行操作的等待时间"
                    Unit="秒" />

                <!--  邮件通知  -->
                <Border
                    Margin="0,15,0,0"
                    Padding="10"
                    Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                    BorderBrush="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                    BorderThickness="1"
                    CornerRadius="8">
                    <ui:SimpleStackPanel Spacing="10">
                        <emoji:TextBlock
                            Margin="0,0,0,5"
                            FontSize="16"
                            FontWeight="SemiBold"
                            Style="{StaticResource TitleTextBlockStyle}">
                            📧 邮件通知
                        </emoji:TextBlock>
                        <controls:SettingItem_ToggleButton
                            x:Name="OfflineActionSendEmail"
                            Title="启用离线后邮件发送"
                            OnToggled="SettingItem_Toggled" />

                        <controls:SettingItem_TextBox
                            x:Name="OfflineActionEmail_SMTPServer"
                            Title="SMTP服务器"
                            DataChanged="SettingItem_TextBox_DataChanged" />

                        <controls:SettingItem_TextBox
                            x:Name="OfflineActionEmail_SMTPPort"
                            Title="SMTP服务器端口"
                            DataChanged="SettingItem_TextBox_DataChanged"
                            Unit="" />

                        <controls:SettingItem_TextBox
                            x:Name="OfflineActionEmail_SMTPUsername"
                            Title="SMTP用户名"
                            DataChanged="SettingItem_TextBox_DataChanged" />

                        <controls:SettingItem_TextBox
                            x:Name="OfflineActionEmail_SMTPPassport"
                            Title="SMTP授权码"
                            DataChanged="SettingItem_TextBox_DataChanged" />

                        <controls:SettingItem_TextBox
                            x:Name="OfflineActionEmail_SMTPSenderEmail"
                            Title="邮件发送方邮箱"
                            DataChanged="SettingItem_TextBox_DataChanged" />

                        <controls:SettingItem_TextBox
                            x:Name="OfflineActionEmail_SMTPReceiveEmail"
                            Title="邮件接收方邮箱"
                            DataChanged="SettingItem_TextBox_DataChanged" />
                    </ui:SimpleStackPanel>
                </Border>

                <!--  终端指令  -->
                <Border
                    Margin="0,15,0,0"
                    Padding="10"
                    Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                    BorderBrush="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                    BorderThickness="1"
                    CornerRadius="8">
                    <ui:SimpleStackPanel Spacing="10">
                        <emoji:TextBlock
                            Margin="0,0,0,5"
                            FontSize="16"
                            FontWeight="SemiBold"
                            Style="{StaticResource TitleTextBlockStyle}">
                            💻 终端指令
                        </emoji:TextBlock>
                        <controls:SettingItem_ToggleButton
                            x:Name="OfflineActionRunCommand"
                            Title="启用离线后执行终端指令"
                            OnToggled="SettingItem_Toggled" />

                        <ListBox
                            x:Name="OfflineActionCommands"
                            MinHeight="20"
                            MaxHeight="150"
                            Margin="0,0,0,10"
                            IsEnabled="{Binding Toggled, ElementName=OfflineActionRunCommand}" />
                        <Grid IsEnabled="{Binding Toggled, ElementName=OfflineActionRunCommand}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Button
                                x:Name="OfflineActionCommandRemoveButton"
                                Grid.Column="0"
                                Width="60"
                                Margin="0,0,10,0"
                                Click="OfflineActionCommandRemoveButton_Click">
                                删除
                            </Button>
                            <TextBox x:Name="OfflineActionCommandAdd" Grid.Column="1" />
                            <Button
                                x:Name="OfflineActionCommandAddButton"
                                Grid.Column="2"
                                Width="60"
                                Margin="10,0,0,0"
                                Click="OfflineActionCommandAddButton_Click">
                                添加
                            </Button>
                        </Grid>
                    </ui:SimpleStackPanel>
                </Border>
            </ui:SimpleStackPanel>
        </Border>
    </ui:SimpleStackPanel>
</Page>